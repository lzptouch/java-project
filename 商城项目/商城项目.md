# 常规配置及基本服务
    配置网关及网关重写
    统一配置跨域
    oss云存储
    JSR303数据校验
    统一异常处理


# 秒杀服务 

## 基本功能
### 列表页：
数据库：
    有独立的数据库  否则原表难以维护
    商品表 秒杀商品表  秒杀用户 用户 订单   秒杀订单  
后端：
    字段  DAO（数据库操作）  service   controller

### 详情页：
商品详细信息   
后端：
    秒杀时间判定  没开始  倒计时  正在进行（按钮可以点击）   已结束  设置秒杀状态
前端：
    在现实商品详情信息时，需要判断用户是否登录  ，用户收获地址是否完整  时间格式化
    商品原价  商品秒杀价  秒杀库存数
    秒杀倒计时（在客户端做  否则太耗时）： 前端实现

### 秒杀功能实现：
    首先检测用户登录  如果没有，返回登录页面
    实际就是实现提交一张表单信息

    查看 秒杀商品数量  
        没有 秒杀失败  
        有 查看该用户是否已经秒杀成功  
            有  返回不能重复
        没有  事务（减库存  下订单） 返回订单详情页    

## 页面级高并发优化  Redis缓存 + 静态化分离
页面缓存 URL缓存  对象缓存 
页面静态化 也即前后端分离（JSP是动态的） 
静态资源优化  CDN优化

### 页面缓存
将一些不是实时刷新的页面放入缓存
不是直接让系统渲染  从缓存中取否则手动渲染 
没有缓存之前：
    数据放在model上
    controller方法返回模版  有SpringBoot进行渲染
加了缓存：
    
    直接获取模版+数据的页面缓存

    获取Springboot的thymeleaf引擎
    获取springContext 中的参数
    引擎利用模版名和参数进行手动渲染


### 对象缓存
    对象缓存不必设置过期时间
    存取缓存按照一般步骤

    对象更新时，需要按照更新缓存

### 页面静态优化
    将页面缓存到浏览器上
### 解决卖超
    检测用户是否重复秒杀，检测是否存在该用户的秒杀订单
    超卖：秒杀商品的库存减小为负数。   一般情况不会被减为负数，但若存在多个用户同时对库存进行判断检测，操作。则有可能。可以利用数据库唯一索引，给用户id和商品id 加唯一索引对秒杀订单进行操作。  这里可以用缓存进行优化

### 静态资源优化
    JS CSS压缩，减少流量
    多个JS CSS组合，减少连接数 
    CDN 

## Rabbit 接口优化
    思路：
    Redis预减库存，减少数据库访问
    内存标记减少Redis访问
    请求先入队缓冲，一步下单，增强用户体验 
    Nginx水平扩展
### 秒杀接口优化
    系统初始化，把商品库存数量加载到Redis中
    收到请求，Redis预减库存，库存不足则直接返回
    仍有库存，将其放入排队中 
    请求出队，生成订单，减少库存
    客户端轮询，是否秒杀成功。

    为了避免当Redis缓存中，商品库存小于0是还有用户对其进行请求判断。用一个HashMap存储商品是否为0的信息。

## 安全优化
### 秒杀接口地址隐藏
    事先不知道服务地址，需要从服务器获取。
    原理：服务器生成随机盐值，与用户 ID、时间戳等信息组合生成动态 URL，客户端请求时携带该 URL，服务器验证合法性

    接口改造，带上pathVariable参数；添加生成地址的接口；秒杀收到请求，先验证pathVariable


### 图形验证码
使用 BufferedImage 创建图像，随机生成数字 + 字母组合的验证码。
添加背景色、噪点和干扰线，增加识别难度。
使用随机旋转和颜色变化，增强安全性。

将生成的验证码存储在 HttpSession 中。
用户提交表单时，比对输入的验证码与 Session 中存储的内容

验证码有效期：设置验证码的有效时间（如 3 分钟），超时后需重新生成。
一次性使用：验证通过后立即从 Session 中移除验证码，防止重复使用。

### 接口限流防刷
引入依赖，
用代码配置限流规则

## 用户登录与分布式session


# 商品服务

## SPU SKU

SPU：商品的 “抽象概念”，描述一类商品的共性（如 iPhone 14 Pro）。
例如：品牌、型号、产品描述、图片等通用属性。
SKU：商品的 “具体实例”，描述一个可售卖的最小单位（如 iPhone 14 Pro 256G 金色）。
例如：颜色、尺寸、配置、价格、库存等差异化属性。


数据模型：通过关联表（SPU→SKU→属性值）实现灵活的商品结构。
业务逻辑：动态生成 SKU 组合（难点），处理库存扣减等原子操作。

## Redis缓存商品热点数据
为了减少数据库的访问

# 订单管理 
RabbitMQ实现订单状态的异步通知